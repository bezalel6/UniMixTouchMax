CompileFlags:
  Add:
    # ESP32-S3 specific defines matching your PlatformIO config
    - -DESP32
    - -DESP32S3
    - -DESP_PLATFORM
    - -DARDUINO_ARCH_ESP32
    - -DARDUINO_ESP32_DEV
    - -DARDUINO_BOARD="ESP32_8048S070C"
    - -DARDUINO_VARIANT="esp32s3"
    - -DARDUINO_PARTITION_default
    - -DCONFIG_IDF_TARGET_ESP32S3=1
    - -DCONFIG_FREERTOS_HZ=1000
    - -DCONFIG_ESP32S3_DEFAULT_CPU_FREQ_240=1
    - -DCONFIG_ESP_SYSTEM_EVENT_TASK_STACK_SIZE=2304
    - -DCONFIG_ESP_MAIN_TASK_STACK_SIZE=3584
    - -DCONFIG_ESP_CONSOLE_UART_DEFAULT=1
    - -DCONFIG_ESP_CONSOLE_UART=1
    - -DCONFIG_ESP_CONSOLE_UART_NUM=0
    - -DCONFIG_ESP_CONSOLE_UART_BAUDRATE=115200
    - -DCONFIG_LWIP_MAX_SOCKETS=10
    - -DCONFIG_LWIP_SO_REUSE=1
    - -DCONFIG_LWIP_SO_RCVBUF=1
    - -DCONFIG_LWIP_DHCP_MAX_NTP_SERVERS=1
    - -DCONFIG_LWIP_SNTP_UPDATE_DELAY=3600000
    - -DCONFIG_PARTITION_TABLE_SINGLE_APP=1
    - -DCONFIG_PARTITION_TABLE_SINGLE_APP_LARGE=1
    - -DCONFIG_ESP_TASK_WDT_EN=1
    - -DCONFIG_FREERTOS_GENERATE_RUN_TIME_STATS=1
    - -DCONFIG_FREERTOS_USE_TRACE_FACILITY=1
    - -DCONFIG_FREERTOS_USE_STATS_FORMATTING_FUNCTIONS=1

    # LVGL configuration matching your setup
    - -DLV_CONF_PATH="include/lv_conf.h"
    - -DLV_LVGL_H_INCLUDE_SIMPLE

    # Architecture and toolchain matching PlatformIO
    - -fno-jump-tables
    - -ffunction-sections
    - -fdata-sections
    - -Wall
    - -Wextra
    - -Wno-missing-field-initializers
    - -Wno-unused-parameter
    - -Wno-unused-function
    - -Wno-unused-variable
    - -Wno-error=unused-function
    - -Wno-error=unused-variable
    - -Wno-error=unused-but-set-variable
    - -Wno-error=deprecated-declarations
    - -Wno-sign-compare
    - -Wno-enum-conversion
    - -gdwarf-4
    - -ggdb
    - -O2
    - -fmacro-prefix-map=~/.platformio/packages/framework-arduinoespressif32/=ARDUINO/
    - -fmacro-prefix-map=~/.platformio/packages/toolchain-xtensa-esp32s3/=TOOLCHAIN/
    - -fmacro-prefix-map=$PROJECT_DIR/=PROJECT/
    - -fmacro-prefix-map=$PWD/=PROJECT/
    - -Wno-frame-address
    - -fno-rtti
    - -fno-exceptions
    - -std=gnu++20
    - -include
    - PIOConfig.h

    # Force clangd to continue parsing even with errors
    - -ferror-limit=0
    - -fparse-all-comments

    # PlatformIO and Arduino ESP32 include paths
    - -I~/.platformio/packages/framework-arduinoespressif32/libraries/WiFi/src
    - -I~/.platformio/packages/framework-arduinoespressif32/libraries/FS/src
    - -I~/.platformio/packages/framework-arduinoespressif32/libraries/SD/src
    - -I~/.platformio/packages/framework-arduinoespressif32/libraries/SPI/src
    - -I~/.platformio/packages/framework-arduinoespressif32/libraries/Wire/src
    - -I~/.platformio/packages/framework-arduinoespressif32/libraries/SPIFFS/src
    - -I~/.platformio/packages/framework-arduinoespressif32/libraries/HTTPClient/src
    - -I~/.platformio/packages/framework-arduinoespressif32/libraries/WebServer/src
    - -I~/.platformio/packages/framework-arduinoespressif32/libraries/Update/src
    - -I~/.platformio/packages/framework-arduinoespressif32/libraries/ESPmDNS/src
    - -I~/.platformio/packages/framework-arduinoespressif32/libraries/ArduinoOTA/src
    - -I~/.platformio/packages/framework-arduinoespressif32/libraries/Preferences/src
    - -I~/.platformio/packages/framework-arduinoespressif32/libraries/BluetoothSerial/src
    - -I~/.platformio/packages/framework-arduinoespressif32/libraries/WiFiClientSecure/src
    - -I~/.platformio/packages/framework-arduinoespressif32/libraries/HTTPUpdate/src
    - -I~/.platformio/packages/framework-arduinoespressif32/libraries/NetBIOS/src
    - -I~/.platformio/packages/framework-arduinoespressif32/libraries/SimpleBLE/src
    - -I~/.platformio/packages/framework-arduinoespressif32/libraries/USB/src
    - -I~/.platformio/packages/framework-arduinoespressif32/libraries/WebSocketsServer/src
    - -I~/.platformio/packages/framework-arduinoespressif32/libraries/WiFiProv/src
    - -I~/.platformio/packages/framework-arduinoespressif32/libraries/RainMaker/src

    # Arduino ESP32 core includes
    - -I~/.platformio/packages/framework-arduinoespressif32/cores/esp32
    - -I~/.platformio/packages/framework-arduinoespressif32/variants/esp32s3
    - -I~/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32s3/include
    - -I~/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32s3/include/freertos
    - -I~/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32s3/include/freertos/include
    - -I~/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32s3/include/freertos/include/freertos
    - -I~/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32s3/include/freertos/port/xtensa/include
    - -I~/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32s3/include/esp_hw_support/include
    - -I~/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32s3/include/esp_hw_support/include/soc
    - -I~/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32s3/include/esp_hw_support/include/soc/esp32s3
    - -I~/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32s3/include/driver/include
    - -I~/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32s3/include/driver/deprecated
    - -I~/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32s3/include/log/include
    - -I~/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32s3/include/esp_common/include
    - -I~/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32s3/include/esp_rom/include
    - -I~/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32s3/include/esp_system/include
    - -I~/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32s3/include/hal/include
    - -I~/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32s3/include/hal/esp32s3/include
    - -I~/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32s3/include/soc/include
    - -I~/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32s3/include/soc/esp32s3/include
    - -I~/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32s3/include/xtensa/include
    - -I~/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32s3/include/xtensa/esp32s3/include
    - -I~/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32s3/include/lwip/include
    - -I~/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32s3/include/lwip/include/apps
    - -I~/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32s3/include/lwip/lwip/src/include
    - -I~/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32s3/include/lwip/port/esp32xx/include
    - -I~/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32s3/include/lwip/port/esp32xx/include/arch
    - -I~/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32s3/include/esp_wifi/include
    - -I~/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32s3/include/esp_netif/include
    - -I~/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32s3/include/esp_event/include
    - -I~/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32s3/include/esp_timer/include
    - -I~/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32s3/include/nvs_flash/include
    - -I~/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32s3/include/spi_flash/include
    - -I~/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32s3/include/esp_partition/include
    - -I~/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32s3/include/app_update/include
    - -I~/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32s3/include/bootloader_support/include
    - -I~/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32s3/include/esp_phy/include
    - -I~/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32s3/include/esp_ipc/include
    - -I~/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32s3/include/esp_pm/include
    - -I~/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32s3/include/esp_psram/include
    - -I~/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32s3/include/esp_ringbuf/include
    - -I~/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32s3/include/esp_adc/include
    - -I~/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32s3/include/esp_eth/include
    - -I~/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32s3/include/esp_gdbstub/include
    - -I~/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32s3/include/esp_hid/include
    - -I~/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32s3/include/esp_http_client/include
    - -I~/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32s3/include/esp_http_server/include
    - -I~/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32s3/include/esp_https_ota/include
    - -I~/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32s3/include/esp_https_server/include
    - -I~/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32s3/include/esp_local_ctrl/include
    - -I~/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32s3/include/esp_mm/include
    - -I~/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32s3/include/esp_serial_slave_link/include
    - -I~/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32s3/include/esp_websocket_client/include
    - -I~/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32s3/include/esp-tls/include
    - -I~/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32s3/include/esp-tls/esp-tls-crypto
    - -I~/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32s3/include/esp_littlefs/include
    - -I~/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32s3/include/esp_vfs_dev/include
    - -I~/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32s3/include/esp_vfs_fat/include
    - -I~/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32s3/include/esp_vfs_semihost/include
    - -I~/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32s3/include/esp_vfs_usb_serial_jtag/include
    - -I~/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32s3/include/fatfs/src
    - -I~/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32s3/include/fatfs/vfs
    - -I~/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32s3/include/wear_levelling/include
    - -I~/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32s3/include/sdmmc/include
    - -I~/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32s3/include/esp_serial_slave_link/include

    # Library dependencies paths (adjust as needed for your .platformio/libdeps location)
    - -I.pio/libdeps/esp32-8048S070C/esp32_smartdisplay/src
    - -I.pio/libdeps/esp32-8048S070C/ArduinoJson/src
    - -I.pio/libdeps/esp32-8048S070C/PubSubClient/src
    - -I.pio/libdeps/esp32-8048S070C/tiny-regex-c

    # Project specific includes
    - -I.pio/build/esp32_shared/config
    - -Isrc
    - -Iinclude
    - -Ilib
    - -Icomponents
    - -Imain

  Remove:
    # Remove problematic flags that clangd doesn't understand
    - -mtext-section-literals
    - -mlongcalls
    - -mlong-calls
    - -mcpu=esp32s3
    - -mfix-esp32-psram-cache-issue
    - -fstrict-volatile-bitfields
    - -fno-tree-switch-conversion
    - -std=gnu++11

Index:
  Background: Build
  StandardLibrary: No
  # Allow indexing even with errors
  AllowBrokenHeaderUnits: true

Diagnostics:
  Suppress:
    - pp_file_not_found
    - unknown_typename
    - unknown_identifier
  ClangTidy:
    Add:
      - readability-*
      - performance-*
      - modernize-*
      - bugprone-*
    Remove:
      - readability-magic-numbers
      - readability-uppercase-literal-suffix
      - modernize-use-trailing-return-type
      - bugprone-easily-swappable-parameters
      - modernize-use-auto
  # Continue analyzing even when there are errors
  ContinueAfterError: true
  # Allow incomplete translation units
  IncompleteTranslationUnit: true

InlayHints:
  Enabled: true
  ParameterNames: true
  DeducedTypes: true

Hover:
  ShowAKA: true

# For better performance with large codebases
---
If:
  PathMatch: .*\.(c|cpp|cc|cxx|h|hpp|hxx)$
CompileFlags:
  Add:
    - -ferror-limit=0

# Exclude deprecated files matching your PlatformIO src_filter
---
If:
  PathMatch: .*/src/messaging/deprecated/.*
CompileFlags:
  Add:
    - -w
